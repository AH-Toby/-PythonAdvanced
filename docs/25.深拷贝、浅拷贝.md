# 深拷贝、浅拷贝

## 1.变量的含义

```python
a = 10
```

这个变量的意义是什么呢？？ 

**有一个变量a引用存储10的空间地址**

**注意：**

32位的操作系统的int长度为4个字节，最大的内存只能够有4g,也就是最大数值为：2<sup>32</sup>

 64位为8个字节:最大数值也就是2<sup>64</sup>

**深拷贝：** 拷贝的程度深，自己新开辟了一块内存，将被拷贝内容全部拷贝过来了；
**浅拷贝：** 拷贝的程度浅，只拷贝原数据的首地址，然后通过原数据的首地址，去获取内容。
**两者的优缺点对比：**
1.深拷贝拷贝程度高，将原数据复制到新的内存空间中。改变拷贝后的内容不影响原数据内容。但是深拷贝耗时长，且占用内存空间。
2.浅拷贝拷贝程度低，只复制原数据的地址。其实是将副本的地址指向原数据地址。修改副本内容，是通过当前地址指向原数据地址，去修改。所以修改副本内容会影响到原数据内容。但是浅拷贝耗时短，占用内存空间少。

## 2.浅拷贝

* 浅拷贝是对于一个对象的顶层拷贝

通俗的理解：拷贝了引用，没有拷贝内容

demo:

```
In [1]: a = [11,22]                                                                       

In [2]: b = a                                                                             

In [3]: b.append(33)                                                                      

In [4]: b                                                                                 
Out[4]: [11, 22, 33]

In [5]: a                                                                                 
Out[5]: [11, 22, 33]

In [6]: id(a)                                                                             
Out[6]: 140242596308288

In [7]: id(b)                                                                             
Out[7]: 140242596308288
```



## 3.深拷贝

- 深拷贝是对于一个对象所有层次的拷贝(递归)

demo:

```
In [1]: a = [11, 22]                                                            

In [2]: b = a                                                                   

In [3]: b.append(33)                                                            

In [4]: a                                                                       
Out[4]: [11, 22, 33]

In [5]: b                                                                       
Out[5]: [11, 22, 33]

In [6]: # 深拷贝                                                                

In [7]: import copy                                                             

In [8]: c = copy.deepcopy(a)                                                    

In [9]: c                                                                       
Out[9]: [11, 22, 33]

In [10]: b                                                                      
Out[10]: [11, 22, 33]

In [11]: a                                                                      
Out[11]: [11, 22, 33]

In [12]: b.append(44)                                                           

In [13]: a                                                                      
Out[13]: [11, 22, 33, 44]

In [14]: b                                                                      
Out[14]: [11, 22, 33, 44]

In [15]: c                                                                      
Out[15]: [11, 22, 33]

In [16]: id(a)                                                                  
Out[16]: 140271203371200

In [17]: id(b)                                                                  
Out[17]: 140271203371200

In [18]: id(c)                                                                  
Out[18]: 140271238781248

In [19]: # 深拷贝会生成一个新的对象                                                                                                                 
```



## 4.copy()研究

* 对于可变类型copy也会产生一个新的对象    

```
In [1]: a = [11, 22]                                                            

In [2]: b = a                                                                   

In [3]: b.append(33)                                                            

In [4]: a                                                                       
Out[4]: [11, 22, 33]

In [5]: b                                                                       
Out[5]: [11, 22, 33]

In [6]: # 深拷贝                                                                

In [7]: import copy                                                             

In [8]: c = copy.deepcopy(a)                                                    

In [9]: c                                                                       
Out[9]: [11, 22, 33]

In [10]: b                                                                      
Out[10]: [11, 22, 33]

In [11]: a                                                                      
Out[11]: [11, 22, 33]

In [12]: b.append(44)                                                           

In [13]: a                                                                      
Out[13]: [11, 22, 33, 44]

In [14]: b                                                                      
Out[14]: [11, 22, 33, 44]

In [15]: c                                                                      
Out[15]: [11, 22, 33]

In [16]: id(a)                                                                  
Out[16]: 140271203371200

In [17]: id(b)                                                                  
Out[17]: 140271203371200

In [18]: id(c)                                                                  
Out[18]: 140271238781248

In [19]: # 深拷贝会生成一个新的对象                                             

In [20]: # 浅拷贝对可变类型的作用                                                                                                                                                                                                                                             

In [21]: d = copy.copy(a)                                                                                                                                                                                                                                                     

In [22]: a                                                                                                                                                                                                                                                                    
Out[22]: [11, 22, 33, 44]

In [23]: b                                                                                                                                                                                                                                                                    
Out[23]: [11, 22, 33, 44]

In [24]: c                                                                                                                                                                                                                                                                    
Out[24]: [11, 22, 33]

In [25]: d                                                                                                                                                                                                                                                                    
Out[25]: [11, 22, 33, 44]

In [26]: b.append(55)                                                                                                                                                                                                                                                         

In [27]: a                                                                                                                                                                                                                                                                    
Out[27]: [11, 22, 33, 44, 55]

In [28]: b                                                                                                                                                                                                                                                                    
Out[28]: [11, 22, 33, 44, 55]

In [29]: c                                                                                                                                                                                                                                                                    
Out[29]: [11, 22, 33]

In [30]: d                                                                                                                                                                                                                                                                    
Out[30]: [11, 22, 33, 44]

In [31]: # 浅拷贝copy函数对于可变类型也会产生一个新的对象                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
```



## 5.更加深入研究

* 1.外层可变内层也可变`[[],[]]`

demo:

```
In [1]: # 外层可变内层也可变                                                                                                                                                                                                                                                  

In [2]: import copy                                                                                                                                                                                                                                                           

In [3]: a = [11, 22]                                                                                                                                                                                                                                                          

In [4]: b = [33, 44]                                                                                                                                                                                                                                                          

In [5]: c = [a, b]                                                                                                                                                                                                                                                            

In [6]: c                                                                                                                                                                                                                                                                     
Out[6]: [[11, 22], [33, 44]]

In [7]: d = copy.copy(c)                                                                                                                                                                                                                                                      

In [8]: e = copy.deepcopy(c)                                                                                                                                                                                                                                                  

In [9]: d                                                                                                                                                                                                                                                                     
Out[9]: [[11, 22], [33, 44]]

In [10]: e                                                                                                                                                                                                                                                                    
Out[10]: [[11, 22], [33, 44]]

In [11]: id(c)                                                                                                                                                                                                                                                                
Out[11]: 140490367216960

In [12]: id(d)                                                                                                                                                                                                                                                                
Out[12]: 140490382363072

In [13]: id(e)                                                                                                                                                                                                                                                                
Out[13]: 140490379554368

In [14]: # 从这边看浅拷贝copy和深拷贝deepcopy都会产生一个新的对象                                                                                                                                                                                                             

In [15]: # 内层变化                                                                                                                                                                                                                                                           

In [16]: a.append(55)                                                                                                                                                                                                                                                         

In [17]: c                                                                                                                                                                                                                                                                    
Out[17]: [[11, 22, 55], [33, 44]]

In [18]: d                                                                                                                                                                                                                                                                    
Out[18]: [[11, 22, 55], [33, 44]]

In [19]: e                                                                                                                                                                                                                                                                    
Out[19]: [[11, 22], [33, 44]]

In [20]: # 浅拷贝内部会随着外部变化而变化  
```

* 2.外层不可变内层可变`([],[])`

demo:

```
In [1]: # 外层不可变内层可变                                                                                                                                                                                                                                                    

In [2]: import copy                                                                                                                                                                                                                                                             

In [3]: a = [11, 22]                                                                                                                                                                                                                                                            

In [4]: b = [33, 44]                                                                                                                                                                                                                                                            

In [5]: c = (a, b)                                                                                                                                                                                                                                                              

In [6]: d = copy.copy(c)                                                                                                                                                                                                                                                        

In [7]: e = copy.deepcopy(c)                                                                                                                                                                                                                                                    

In [8]: c                                                                                                                                                                                                                                                                       
Out[8]: ([11, 22], [33, 44])

In [9]: d                                                                                                                                                                                                                                                                       
Out[9]: ([11, 22], [33, 44])

In [10]: e                                                                                                                                                                                                                                                                      
Out[10]: ([11, 22], [33, 44])

In [11]: id(c)                                                                                                                                                                                                                                                                  
Out[11]: 140464243333120

In [12]: id(d)                                                                                                                                                                                                                                                                  
Out[12]: 140464243333120

In [13]: id(e)                                                                                                                                                                                                                                                                  
Out[13]: 140464255921984

In [14]: # 浅拷贝在拷贝不可变类型的时候值会添加一个新的引用                                                                                                                                                                                                                     

In [15]: # 深拷贝在拷贝不可变类型的时候会生成一个新的对象                                                                                                                                                                                                                       

In [16]: a.append(55)                                                                                                                                                                                                                                                           

In [17]: c                                                                                                                                                                                                                                                                      
Out[17]: ([11, 22, 55], [33, 44])

In [18]: d                                                                                                                                                                                                                                                                      
Out[18]: ([11, 22, 55], [33, 44])

In [19]: e                                                                                                                                                                                                                                                                      
Out[19]: ([11, 22], [33, 44])

In [20]: # 深拷贝在拷贝不可变类型的时候会生成一个新的对象，内层也会生成一个新的对象                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
```

* 对于不可变类型

```
In [1]: # 对于不可变类型                                                                                                                                                                                                                                                        

In [2]: import copy                                                                                                                                                                                                                                                             

In [3]: a = (11, 22)                                                                                                                                                                                                                                                            

In [4]: b = (33, 44)                                                                                                                                                                                                                                                            

In [5]: c = (a, b)                                                                                                                                                                                                                                                              

In [6]: d = copy.copy(c)                                                                                                                                                                                                                                                        

In [7]: e = copy.deepcopy(c)                                                                                                                                                                                                                                                    

In [8]: c                                                                                                                                                                                                                                                                       
Out[8]: ((11, 22), (33, 44))

In [9]: d                                                                                                                                                                                                                                                                       
Out[9]: ((11, 22), (33, 44))

In [10]: e                                                                                                                                                                                                                                                                      
Out[10]: ((11, 22), (33, 44))

In [11]: id(a)                                                                                                                                                                                                                                                                  
Out[11]: 140356215837056

In [12]: id(b)                                                                                                                                                                                                                                                                  
Out[12]: 140356211666816

In [13]: id(c)                                                                                                                                                                                                                                                                  
Out[13]: 140356215911616

In [14]: id(d)                                                                                                                                                                                                                                                                  
Out[14]: 140356215911616

In [15]: id(e)                                                                                                                                                                                                                                                                  
Out[15]: 140356215911616

In [16]: # 不可变类型直接添加引用 
```



## 6.拷贝的其他方式

* 分片表达式可以赋值一个序列

demo:

```
....
In [9]: import copy
....                                                                  

In [86]: a = [11,22]                                                                 

In [87]: b  = [33,44]                                                                

In [88]: c = [a,b]                                                                   

In [89]: d = c[:]                                                                    

In [90]: c                                                                           
Out[90]: [[11, 22], [33, 44]]

In [91]: d                                                                           
Out[91]: [[11, 22], [33, 44]]

In [92]: id(c)                                                                       
Out[92]: 140242596217984

In [93]: id(d)                                                                       
Out[93]: 140242596481536

In [94]: a.append(55)                                                                

In [95]: c                                                                           
Out[95]: [[11, 22, 55], [33, 44]]

In [96]: d                                                                           
Out[96]: [[11, 22, 55], [33, 44]]

In [97]: # d = c[:] 与d = copy.copy(c)一样属于浅拷贝      
```

- 字典的copy方法可以拷贝一个字典

demo：

```
....
In [9]: import copy
....

In [98]: d = dict(name="lisi",age=18)                                                

In [99]: co = d.copy()                                                               

In [100]: id(d)                                                                      
Out[100]: 140242669460672

In [101]: id(co)                                                                     
Out[101]: 140242669762176

In [102]: d                                                                          
Out[102]: {'name': 'lisi', 'age': 18}

In [103]: co                                                                         
Out[103]: {'name': 'lisi', 'age': 18}

In [104]: d = dict(name="lisi",age=18,height_weight=[180,60])                        

In [105]: co = d.copy()                                                              

In [106]: d["height_weight"].append(70)                                              

In [107]: d                                                                          
Out[107]: {'name': 'lisi', 'age': 18, 'height_weight': [180, 60, 70]}

In [108]: co                                                                         
Out[108]: {'name': 'lisi', 'age': 18, 'height_weight': [180, 60, 70]}

In [109]: # 字典的拷贝与copy方法一样属于浅拷贝     
```



## 7. 注意点

#### 浅拷贝对不可变类型和可变类型的copy不同

1. copy.copy对于可变类型，会进行浅拷贝
2. copy.copy对于不可变类型，不会拷贝，仅仅是指向

## 8.总结

**可变类型：**

1. 最外层是可变类型：`[[][]]`一定会产生新的地址，copy是浅拷贝，内层会拷贝引用，deepcopy是深拷贝，会将内层的对象拷贝一份全新的
2. 外层是不可变类型内层可变`([],[])`copy是指向，deepcopy是深拷贝

**不可变类型：**

`(()())`copy和deepcopy对于一个全部都是不可变类型进行数据拷贝的时候，那么他们的结果相同，都是引用指向



